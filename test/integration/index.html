<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Integration Tests</title>

    <link href="style.css" rel="stylesheet" type="text/css"/>

    <script type="text/javascript" src="out/vendor.js"></script>

    <script type="text/javascript" src="config.js"></script>
	<script type="text/javascript" src="out/app.js" charset="UTF-8"></script>

    <script>

      function runIntegrationTests(){
        var supportCode,
            xhr = new XMLHttpRequest();

        xhr.open('GET', window.IntegrationTestConfig.featurePath, false);
        xhr.send();

        if(xhr.status != 200){
            return;
        }

        var featureSource = '# language: ru\n' + xhr.responseText;

        xhr.open('GET', window.IntegrationTestConfig.stepDefinitionsPath, false);
        xhr.send();

        if(xhr.status != 200){
            return;
        }

        eval('supportCode = function() {' + xhr.responseText + '};');

        var listener = CucumberHTMLListener($('#test-result'), $('#test-info'));

        var options = {
            tags: [
                "~@ignore"
            ]
        };

        if(window.location.hash != ""){
            var hash = window.location.hash.substring(1).replace(/'/g,'"');
            
            if (hash.indexOf('{') === -1 && hash.indexOf('}') === -1) {
                hash = '{' + hash + '}';
            }
            
            window.startUpParameters = JSON.parse(hash);
        }

        if(window.startUpParameters && window.startUpParameters.tags){
            options.tags.push(window.startUpParameters.tags);
        }

        var cucumber = Cucumber(featureSource, supportCode, options);

        cucumber.attachListener(listener);

        try {
            cucumber.start(function() {});
        } catch(err) {
            console.log(err);
            $('#test-result').text(err.message);
        }
      }
    </script>
  </head>

  <body onload="runIntegrationTests()">
    <div id="test-info">
       <span>
        <span>Passed: </span>
        <span id="passed-count">0</span>
      </span>
      <span>
        <span>Failed: </span>
        <span id="failed-count">0</span>
      </span>
      <span>
        <span>Ignored: </span>
        <span id="ignored-count">0</span>
      </span>
    </div>
    <div id="test-result"></div>
  </body>
</html>
